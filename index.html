<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>title</title>
    <script src="http://cdn.peerjs.com/0.3/peer.js"></script>
</head>

<body>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        var peer = null

        var ip = ""

        window.RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection; //compatibility for firefox and chrome
        var pc = new RTCPeerConnection({
                iceServers: []
            }),
            noop = function() {};
        pc.createDataChannel(""); //create a bogus data channel
        pc.createOffer(pc.setLocalDescription.bind(pc), noop); // create offer and set local description
        pc.onicecandidate = function(ice) { //listen for candidate events
            if (!ice || !ice.candidate || !ice.candidate.candidate) return;
            var myIP = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ice.candidate.candidate)[1];
            // console.log('my IP: ', myIP);
            ip = myIP
            pc.onicecandidate = noop;

            setTimeout(connect, 10)
        };

        function autorun() {

        }

        function connect() {
          my_id = ip.split('.')[2]+'.'+ip.split('.')[3]

          peer = new Peer(my_id, {
              key: 'k21h7zsvzls4te29'
          });

          peer.on('connection', function(conn) {
              conn.on('data', function(data) {
                  // Will print 'hi!'
                  console.log(data);
              });
          });

          alert("Your id: "+my_id)

          other_id = prompt("Other id: ")

          var conn = peer.connect(other_id);
          conn.on('open', function() {
              conn.send('hi!');
          });
        }

        if (window.addEventListener) window.addEventListener("load", autorun, false);
        else if (window.attachEvent) window.attachEvent("onload", autorun);
        else window.onload = autorun;
    </script>
</body>

</html>
